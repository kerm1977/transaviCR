{% extends 'base.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10"> 
        <div class="card p-4 shadow-lg border-warning" style="border-radius: 20px;">
            <div class="text-center mb-4 mb-md-5">
                <h1 class="h2 fw-bold text-warning mb-2">Reserva tu Transporte</h1>
                <p class="text-warning-muted small text-uppercase ls-2">Selecciona una categoría para continuar</p>
                <!-- Botón para ver perfil (opcional, si implementaste profile) -->
                <div class="mt-2">
                    <a href="/perfil" class="btn btn-sm btn-outline-dark rounded-pill px-3">
                        <i class="fas fa-search me-1"></i> Ver mis Solicitudes
                    </a>
                </div>
            </div>
            
            <!-- Selector de Servicios (Grid 2x2 en Móvil/Tablet - Fila de 4 en PC) -->
            <div class="row g-2 g-md-3 mb-4 mb-md-5 justify-content-center" id="serviceCards">
                <!-- Transporte Estudiantes -->
                <div class="col-6 col-lg-3">
                    <input type="radio" class="btn-check" name="service_category" id="opt_estudiantes" value="estudiantes" onchange="selectService('estudiantes')" checked>
                    <label class="card h-100 border-0 bg-light-warning service-card cursor-pointer" for="opt_estudiantes">
                        <div class="card-body text-center p-2 p-xl-4 d-flex flex-column justify-content-center align-items-center">
                            <div class="icon-flat mb-2 mx-auto bg-white rounded-circle shadow-sm d-flex align-items-center justify-content-center">
                                <i class="fas fa-graduation-cap text-warning responsive-icon"></i>
                            </div>
                            <h6 class="fw-bold text-dark mb-0 responsive-text">TRANSPORTE DE<br>ESTUDIANTES</h6>
                        </div>
                    </label>
                </div>

                <!-- Servicios Especiales -->
                <div class="col-6 col-lg-3">
                    <input type="radio" class="btn-check" name="service_category" id="opt_especiales" value="especiales" onchange="selectService('especiales')">
                    <label class="card h-100 border-0 bg-light service-card cursor-pointer" for="opt_especiales">
                        <div class="card-body text-center p-2 p-xl-4 d-flex flex-column justify-content-center align-items-center">
                            <div class="icon-flat mb-2 mx-auto bg-white rounded-circle shadow-sm d-flex align-items-center justify-content-center">
                                <i class="fas fa-star text-warning responsive-icon"></i>
                            </div>
                            <h6 class="fw-bold text-dark mb-0 responsive-text">SERVICIOS<br>ESPECIALES</h6>
                        </div>
                    </label>
                </div>

                <!-- Viajes Internacionales -->
                <div class="col-6 col-lg-3">
                    <input type="radio" class="btn-check" name="service_category" id="opt_internacional" value="internacional" onchange="selectService('internacional')">
                    <label class="card h-100 border-0 bg-light service-card cursor-pointer" for="opt_internacional">
                        <div class="card-body text-center p-2 p-xl-4 d-flex flex-column justify-content-center align-items-center">
                            <div class="icon-flat mb-2 mx-auto bg-white rounded-circle shadow-sm d-flex align-items-center justify-content-center">
                                <i class="fas fa-globe-americas text-warning responsive-icon"></i>
                            </div>
                            <h6 class="fw-bold text-dark mb-0 responsive-text">VIAJES<br>INTERNACIONALES</h6>
                        </div>
                    </label>
                </div>

                <!-- Transporte Corporativo -->
                <div class="col-6 col-lg-3"> 
                    <input type="radio" class="btn-check" name="service_category" id="opt_corporativo" value="corporativo" onchange="selectService('corporativo')">
                    <label class="card h-100 border-0 bg-light service-card cursor-pointer" for="opt_corporativo">
                        <div class="card-body text-center p-2 p-xl-4 d-flex flex-column justify-content-center align-items-center">
                            <div class="icon-flat mb-2 mx-auto bg-white rounded-circle shadow-sm d-flex align-items-center justify-content-center">
                                <i class="fas fa-briefcase text-warning responsive-icon"></i>
                            </div>
                            <h6 class="fw-bold text-dark mb-0 responsive-text">TRANSPORTE<br>CORPORATIVO</h6>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Contenedor dinámico de formularios -->
            <div id="dynamicFormContainer" class="d-none animate__animated animate__fadeIn">
                <hr class="border-warning opacity-25 my-4">

                <!-- Título Dinámico de la Sección -->
                <div class="text-center mb-4">
                    <h4 class="fw-bold text-dark text-uppercase ls-1" id="formTitle">DETALLES DEL VIAJE</h4>
                    <p class="text-muted small">Complete la información a continuación para su solicitud</p>
                </div>

                <!-- 1. SECCIÓN DATOS PERSONALES -->
                <div class="bg-light p-4 rounded mb-4 border border-1">
                    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-3">
                        <h5 class="fw-bold text-primary m-0 mb-3 mb-lg-0">DATOS PERSONALES</h5>
                        
                        <!-- Input Group PIN -->
                        <div class="input-group input-group-sm w-100 w-lg-auto">
                            <span class="input-group-text bg-warning fw-bold text-dark">PIN</span>
                            <input type="text" id="client_pin" form="formEstandar" name="client_pin" class="form-control" placeholder="¿Ya tienes PIN?" maxlength="8" style="text-transform: uppercase;">
                            <button type="button" class="btn btn-dark" onclick="fetchClientData()">Cargar</button>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Nombre <span class="text-danger">*</span></label>
                            <input type="text" id="client_name" form="formEstandar" name="client_name" class="form-control strict-name" placeholder="Tu Nombre" required>
                            <div class="form-text x-small">Sin espacios, números ni símbolos.</div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Primer Apellido <span class="text-danger">*</span></label>
                            <input type="text" id="client_lastname1" form="formEstandar" name="client_lastname1" class="form-control strict-name" placeholder="Primer Apellido" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Segundo Apellido <span class="text-danger">*</span></label>
                            <input type="text" id="client_lastname2" form="formEstandar" name="client_lastname2" class="form-control strict-name" placeholder="Segundo Apellido" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Teléfono / WhatsApp <span class="text-danger">*</span></label>
                            <input type="tel" id="client_phone" form="formEstandar" name="client_phone" class="form-control strict-phone" placeholder="88888888" maxlength="8" required>
                            <div class="form-text x-small">Exactamente 8 dígitos numéricos.</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">Email <span class="text-danger">*</span></label>
                            <input type="email" id="client_email" form="formEstandar" name="client_email" class="form-control" placeholder="nombre@correo.com" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">Otros Detalles a Saber</label>
                            <textarea form="formEstandar" name="comments" class="form-control" rows="2" placeholder="Información adicional importante sobre el pasajero..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Formulario Estándar -->
                <form id="formEstandar" action="/reserve" method="POST">
                    <input type="hidden" name="service_type" id="hiddenServiceType" value="Transporte de Estudiantes">

                    <!-- A. CAMPOS INTERNACIONALES -->
                    <div id="internationalFields" class="service-section d-none">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small"><i class="fas fa-flag text-warning me-1"></i> SELECCIONA PAÍS DESTINO</label>
                                <select name="int_country" class="form-select bg-light border-0">
                                    <option value="Panamá">Panamá</option>
                                    <option value="Nicaragua">Nicaragua</option>
                                    <option value="El Salvador">El Salvador</option>
                                    <option value="Honduras">Honduras</option>
                                    <option value="Guatemala">Guatemala</option>
                                    <option value="México">México</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">ORIGEN (SALIDA)</label>
                                <input type="text" name="origin" class="form-control bg-light border-0" placeholder="Lugar de salida en Costa Rica">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold text-dark small">DESCRIBE MÁS HACIA DONDE TE DIRIGES</label>
                            <textarea name="int_description" class="form-control bg-light border-0" rows="2" placeholder="Ej: Ciudad, Hotel específico, o Tour turístico..."></textarea>
                        </div>

                        <div class="bg-white p-3 rounded border border-warning mb-3">
                            <h6 class="fw-bold text-warning mb-3 small">FECHA PREVISTA</h6>
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <label class="form-label x-small fw-bold">CANTIDAD DE DÍAS</label>
                                    <input type="number" name="int_days" class="form-control bg-light border-0 text-center" min="1" placeholder="Ej: 5">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label x-small fw-bold">DÍA DE SALIDA</label>
                                    <input type="date" name="int_departure_date" class="form-control bg-light border-0">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label x-small fw-bold">DÍA DE REGRESO</label>
                                    <input type="date" name="int_return_date" class="form-control bg-light border-0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- B. CAMPOS ESTUDIANTES -->
                    <div id="studentFields" class="service-section d-none">
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label class="form-label fw-bold text-dark small">INSTITUCIÓN ACADÉMICA</label>
                                <input type="text" name="institution_name" class="form-control bg-light border-0" placeholder="Nombre de la Escuela/Colegio">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">FECHAS REQUERIDAS</label>
                                <select name="schedule_type" class="form-select bg-light border-0" onchange="toggleCustomDate(this.value)">
                                    <option value="Lunes a Viernes">De Lunes a Viernes</option>
                                    <option value="Sábados">Sábados (Clases especiales)</option>
                                    <option value="Personalizado">Horario Personalizado</option>
                                </select>
                            </div>
                            <div id="customDateContainer" class="col-md-6 d-none">
                                <label class="form-label fw-bold text-dark small">DETALLE</label>
                                <input type="text" name="custom_date_detail" class="form-control bg-light border-0" placeholder="Ej: Martes y Jueves">
                            </div>
                        </div>
                    </div>

                    <!-- C. CAMPOS COMUNES -->
                    <div id="commonFields" class="service-section d-none">
                        <div class="mb-4">
                            <label class="form-label fw-bold text-dark small"><i class="far fa-calendar-alt text-warning me-1"></i> FECHA DE SALIDA</label>
                            <div class="row g-2">
                                <div class="col-4">
                                    <select name="day" class="form-select bg-light border-0">
                                        <option value="">Día</option>
                                        {% for d in range(1, 32) %}<option value="{{d}}">{{d}}</option>{% endfor %}
                                    </select>
                                </div>
                                <div class="col-4">
                                    <select name="month" class="form-select bg-light border-0">
                                        <option value="">Mes</option>
                                        {% for m in ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'] %}
                                            <option value="{{loop.index}}">{{m}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-4">
                                    <select name="year" class="form-select bg-light border-0">
                                        <option value="">Año</option>
                                        {% for y in range(2026, 2036) %}
                                            <option value="{{y}}">{{y}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">ORIGEN</label>
                                <input type="text" name="origin" class="form-control bg-light border-0" placeholder="Ej: San José Centro">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">URL (WAZE/MAPS)</label>
                                <input type="url" name="origin_url" class="form-control bg-light border-0" placeholder="https://...">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">DESTINO</label>
                                <input type="text" name="destination" class="form-control bg-light border-0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark small">URL DESTINO</label>
                                <input type="url" name="destination_url" class="form-control bg-light border-0">
                            </div>
                        </div>
                    </div>

                    <!-- Campos Universales -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold text-dark small"><i class="far fa-clock text-warning me-1"></i> HORA DE SALIDA</label>
                            <input type="time" name="time" class="form-control bg-light border-0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold text-dark small">CAPACIDAD (PASAJEROS)</label>
                            <input type="number" name="capacity" class="form-control bg-light border-0" min="1" max="50" required placeholder="Cantidad de personas">
                        </div>
                    </div>

                    <div id="pickupSection" class="mb-3 d-none">
                        <label class="form-label fw-bold text-dark small">¿RECOGER PERSONAS?</label>
                        <select name="pickup" id="pickupSelect" class="form-select bg-light border-0" onchange="togglePickup(this.value)">
                            <option value="no">No, salida directa</option>
                            <option value="si">Sí, agregar paradas</option>
                        </select>
                        <div id="pickupDetail" class="mt-2 d-none">
                            <label class="form-label fw-bold text-dark small">PUNTOS DE RECOGIDA</label>
                            <textarea name="pickup_list" class="form-control bg-light border-0" rows="2" placeholder="Ej: Parada X, Cruce Y, Iglesia Z"></textarea>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-warning btn-lg rounded-pill shadow fw-bold text-dark py-3 hover-scale">
                            SOLICITAR AHORA <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </form>

                <!-- Formulario Corporativo -->
                <form id="formEmpresas" onsubmit="sendToWhatsApp(event)" class="d-none">
                    <div class="alert alert-info small">
                        <i class="fab fa-whatsapp"></i> La solicitud corporativa se enviará directamente al WhatsApp de administración usando los datos personales ingresados arriba.
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold text-dark small">HORARIO PREFERIDO</label>
                        <input type="text" id="comp_hours" class="form-control bg-light border-0" placeholder="Ej: 8:00 AM - 5:00 PM" required>
                    </div>
                    <div class="mb-4">
                        <label class="form-label fw-bold text-dark small">DETALLE SOLICITUD / EMPRESA</label>
                        <textarea id="comp_desc" class="form-control bg-light border-0" rows="4" placeholder="Describa rutas, nombre de la empresa, cantidad de empleados..." required></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg rounded-pill shadow fw-bold py-3 hover-scale">
                            <i class="fab fa-whatsapp me-2"></i> ENVIAR A ADMINISTRACIÓN
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ================= MODAL DE ÉXITO (PIN) ================= -->
<div class="modal fade" id="pinSuccessModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center border-0 shadow-lg p-3">
            <div class="modal-header border-0 justify-content-end pb-0">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body pt-0">
                <div class="mb-3 animate__animated animate__bounceIn">
                    <div class="rounded-circle bg-success d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                        <i class="fas fa-check text-white fa-3x"></i>
                    </div>
                </div>
                <h3 class="fw-bold text-dark mb-2">¡Registro Exitoso!</h3>
                
                <div class="bg-light p-3 rounded-3 border border-2 border-primary border-dashed mb-3 mt-3">
                    <small class="text-muted text-uppercase fw-bold mb-2 d-block">TU PIN DE CLIENTE FRECUENTE</small>
                    <h1 class="display-4 fw-bold text-primary mb-0 letter-spacing-3" id="modalPinValue">--------</h1>
                </div>

                <p class="text-muted mb-4 px-2">
                    <i class="fas fa-info-circle text-primary me-1"></i> Este es tu PIN. <strong>Guárdalo</strong> para seguir solicitando tus viajes y no tengas que volver a ingresar tus datos personales.
                </p>
                
                <button type="button" class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm w-100" data-bs-dismiss="modal">
                    ¡Entendido, gracias!
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .text-warning { color: #ffc107 !important; }
    .bg-light-warning { background-color: #fff3cd !important; }
    .border-warning { border-color: #ffc107 !important; }
    .text-warning-muted { color: #997404 !important; }
    .hover-scale { transition: transform 0.2s; }
    .hover-scale:hover { transform: scale(1.02); }
    .form-control:focus, .form-select:focus { border-color: #ffc107; box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25); }
    
    .service-card { transition: all 0.3s ease; border: 2px solid transparent !important; min-height: 90px; }
    .btn-check:checked + .service-card { background-color: #fff3cd !important; border-color: #ffc107 !important; transform: translateY(-5px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
    .service-card:hover { background-color: #f8f9fa; transform: translateY(-2px); }
    .cursor-pointer { cursor: pointer; }
    .ls-2 { letter-spacing: 2px; }
    .ls-1 { letter-spacing: 1px; }
    .x-small { font-size: 0.75rem; }
    
    .border-dashed { border-style: dashed !important; }
    .letter-spacing-3 { letter-spacing: 3px; }

    @media (max-width: 991px) { /* Hasta LG */
        .responsive-icon { font-size: 1.5rem !important; }
        .icon-flat { width: 45px !important; height: 45px !important; }
        .responsive-text { font-size: 0.8rem !important; line-height: 1.2; }
    }
    
    @media (min-width: 992px) { /* PC grande */
        .responsive-icon { font-size: 2em !important; }
        .icon-flat { width: 60px !important; height: 60px !important; }
        .responsive-text { font-size: 0.9rem !important; }
        #client_pin { max-width: 120px; }
    }
</style>

<script>
    const adminWhatsApp = "{{ about.mobile_admin if about and about.mobile_admin else '00000000' }}";

    document.addEventListener("DOMContentLoaded", function() {
        // --- DETECCIÓN DE PIN EN MENSAJES FLASH PARA EL MODAL ---
        // Buscamos específicamente la categoría 'new_pin_modal' que enviamos desde el backend
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    // Verificamos la categoría exacta que pusimos en rutas.py
                    if ("{{ category }}" === "new_pin_modal") {
                        // El mensaje es solo el PIN limpio
                        const pinValue = "{{ message }}";
                        document.getElementById('modalPinValue').textContent = pinValue;
                        // Mostrar el Modal automáticamente usando Bootstrap
                        const modalElement = document.getElementById('pinSuccessModal');
                        if (modalElement) {
                            const modal = new bootstrap.Modal(modalElement);
                            modal.show();
                        }
                    }
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        // Inicializar
        selectService('estudiantes');
        // Asegurar que solo los campos visibles estén activos
        const pinInput = document.getElementById('client_pin');
        if(pinInput) pinInput.disabled = false;
    });

    // --- VALIDACIONES ESTRICTAS ---
    document.querySelectorAll('.strict-name').forEach(input => {
        input.addEventListener('input', function(e) {
            let val = this.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ]/g, '');
            if (val.length > 0) val = val.charAt(0).toUpperCase() + val.slice(1).toLowerCase();
            this.value = val;
        });
    });
    document.querySelector('.strict-phone').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
    });

    // --- PIN Autocompletar ---
    function fetchClientData() {
        const pin = document.getElementById('client_pin').value;
        if (pin.length < 8) return alert("El PIN debe tener 8 caracteres");
        fetch(`/api/get_client/${pin}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('client_name').value = data.name;
                    document.getElementById('client_lastname1').value = data.last_name1;
                    document.getElementById('client_lastname2').value = data.last_name2;
                    document.getElementById('client_phone').value = data.phone;
                    document.getElementById('client_email').value = data.email;
                    const inputs = document.querySelectorAll('.strict-name, .strict-phone, #client_email');
                    inputs.forEach(i => { i.classList.add('bg-light-warning'); setTimeout(() => i.classList.remove('bg-light-warning'), 1000); });
                } else {
                    alert("PIN no encontrado.");
                }
            })
            .catch(err => console.error(err));
    }

    // --- SELECCIÓN DE SERVICIO ---
    function selectService(serviceKey) {
        const container = document.getElementById('dynamicFormContainer');
        const formEstandar = document.getElementById('formEstandar');
        const formEmpresas = document.getElementById('formEmpresas');
        const hiddenInput = document.getElementById('hiddenServiceType');
        const formTitle = document.getElementById('formTitle');
        
        const studentFields = document.getElementById('studentFields');
        const commonFields = document.getElementById('commonFields');
        const internationalFields = document.getElementById('internationalFields');
        const pickupSection = document.getElementById('pickupSection');

        container.classList.remove('d-none');

        const toggleInputs = (element, enable) => {
            const inputs = element.querySelectorAll('input, select, textarea');
            inputs.forEach(input => input.disabled = !enable);
        };

        if (serviceKey === 'corporativo') {
            formEstandar.classList.add('d-none');
            formEmpresas.classList.remove('d-none');
            formTitle.textContent = "DETALLES CORPORATIVOS";
        } else {
            formEstandar.classList.remove('d-none');
            formEmpresas.classList.add('d-none');
            
            studentFields.classList.add('d-none');
            commonFields.classList.add('d-none');
            internationalFields.classList.add('d-none');
            pickupSection.classList.add('d-none');
            
            toggleInputs(studentFields, false);
            toggleInputs(commonFields, false);
            toggleInputs(internationalFields, false);

            if (serviceKey === 'estudiantes') {
                hiddenInput.value = "Transporte de Estudiantes";
                formTitle.textContent = "DETALLES ESCOLARES";
                studentFields.classList.remove('d-none');
                toggleInputs(studentFields, true);
                
            } else if (serviceKey === 'internacional') {
                hiddenInput.value = "Viajes Internacionales";
                formTitle.textContent = "DETALLES INTERNACIONALES";
                internationalFields.classList.remove('d-none');
                toggleInputs(internationalFields, true);
                
            } else {
                hiddenInput.value = "Servicios Especiales";
                formTitle.textContent = "DETALLES ESPECIALES";
                commonFields.classList.remove('d-none');
                toggleInputs(commonFields, true);
                pickupSection.classList.remove('d-none');
            }
        }
    }

    function togglePickup(val) {
        const div = document.getElementById('pickupDetail');
        if(val === 'si') div.classList.remove('d-none');
        else div.classList.add('d-none');
    }

    function toggleCustomDate(val) {
        const div = document.getElementById('customDateContainer');
        if (val === 'Personalizado') div.classList.remove('d-none');
        else div.classList.add('d-none');
    }

    function sendToWhatsApp(e) {
        e.preventDefault();
        const name = document.getElementById('client_name').value;
        const lname1 = document.getElementById('client_lastname1').value;
        const phone = document.getElementById('client_phone').value;
        const email = document.getElementById('client_email').value;

        if(!name || !lname1 || !phone) return alert("Por favor complete los Datos Personales.");
        if(phone.length !== 8) return alert("El teléfono debe tener 8 dígitos.");

        const hours = document.getElementById('comp_hours').value;
        const desc = document.getElementById('comp_desc').value;

        let message = `*SOLICITUD CORPORATIVA TRANSAVI*%0A-----------------------------------%0A`;
        message += `*Solicitante:* ${name} ${lname1}%0A*Tel:* ${phone}%0A*Email:* ${email}%0A`;
        message += `*Horario:* ${hours}%0A*Detalle:* ${desc}%0A`;

        const waUrl = `https://wa.me/506${adminWhatsApp}?text=${message}`;
        window.open(waUrl, '_blank');
    }
</script>
{% endblock %}